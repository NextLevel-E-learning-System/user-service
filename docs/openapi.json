{
  "openapi": "3.0.3",
  "info": {
    "title": "User Service API",
    "version": "1.5.0",
    "description": "API completa para gest√£o de usu√°rios, instrutores, departamentos e conquistas. Inclui dashboard administrativo, sistema autom√°tico de XP/n√≠veis e funcionalidades completas de CRUD."
  },
  "paths": {
    "/users/v1": {
      "get": {
        "summary": "Listar usu√°rios (ADMIN)",
        "tags": ["users"],
        "security": [{"bearerAuth":[]}],
        "parameters": [
          {"name":"status","in":"query","schema":{"type":"string","enum":["ATIVO","INATIVO"]}},
          {"name":"departamento_id","in":"query","schema":{"type":"string"}},
          {"name":"tipo_usuario","in":"query","schema":{"type":"string","enum":["FUNCIONARIO","INSTRUTOR","ADMIN"]}},
          {"name":"search","in":"query","schema":{"type":"string"}},
          {"name":"limit","in":"query","schema":{"type":"integer","default":50,"minimum":1,"maximum":200}},
          {"name":"offset","in":"query","schema":{"type":"integer","default":0,"minimum":0}}
        ],
        "responses": {"200": {"description": "Lista de usu√°rios","content":{"application/json":{"schema":{"type":"object","properties":{"items":{"type":"array","items":{"$ref":"#/components/schemas/User"}},"total":{"type":"integer"}}}}}}}
      },
      "post": {
        "summary": "Completar cadastro ou atualizar perfil b√°sico",
        "tags": ["users"],
        "security": [{"bearerAuth":[]}],
        "requestBody": {"required": true, "content": {"application/json": {"schema": {"$ref": "#/components/schemas/UserUpsert"}}}},
        "responses": {"200": {"description": "Perfil atualizado","content":{"application/json":{"schema":{"$ref":"#/components/schemas/User"}}}}, "400": {"description": "Dados inv√°lidos"}}
      }
    },
    "/users/v1/me": {
      "get": {"summary": "Obter meu perfil","tags":["users"],"security":[{"bearerAuth":[]}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/User"}}}},"404":{"description":"N√£o encontrado"}}}
    },
    "/users/v1/instructors": {
      "get": {
        "summary": "Listar instrutores ativos",
        "tags": ["instructors"],
        "security": [{"bearerAuth":[]}],
        "responses": {
          "200": {
            "description": "Lista de instrutores com especialidades e avalia√ß√µes",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {"$ref": "#/components/schemas/Instructor"}
                }
              }
            }
          }
        }
      }
    },
    "/users/v1/dashboard": {
      "get": {
        "summary": "Dashboard inteligente baseado no perfil do usu√°rio",
        "description": "üéØ **Dashboard √∫nico que adapta conte√∫do automaticamente baseado no role:**\n\nüë§ **FUNCIONARIO** (R03): XP atual, n√≠vel, badges, cursos em andamento/conclu√≠dos/dispon√≠veis, ranking departamental, timeline de atividades, menu de opera√ß√µes\n\nüë®‚Äçüè´ **INSTRUTOR** (R11): Cursos que ministra com estat√≠sticas, avalia√ß√µes pendentes de corre√ß√£o, m√©tricas de performance (taxa de conclus√£o, avalia√ß√£o m√©dia)\n\nüëë **ADMIN** (R17): M√©tricas gerais da plataforma, usu√°rios ativos, cursos populares, engajamento por departamento, alertas do sistema",
        "tags": ["dashboard"],
        "security": [{"bearerAuth":[]}],
        "responses": {
          "200": {
            "description": "Dashboard personalizado baseado no role do usu√°rio",
            "content": {
              "application/json": {
                "examples": {
                  "funcionario": {
                    "summary": "Dashboard Funcion√°rio",
                    "value": {
                      "tipo_dashboard": "funcionario",
                      "xp_atual": 2500,
                      "nivel_atual": 3,
                      "proximo_badge": "Ouro",
                      "progresso_nivel": 50,
                      "cursos_concluidos": [{"codigo": "HTML101", "titulo": "HTML B√°sico", "xp_oferecido": 100}],
                      "cursos_disponiveis": [{"codigo": "CSS101", "titulo": "CSS B√°sico", "xp_oferecido": 150}],
                      "menu_operacoes": [{"nome": "Cat√°logo de Cursos", "url": "/catalogo", "icone": "book"}]
                    }
                  },
                  "instrutor": {
                    "summary": "Dashboard Instrutor", 
                    "value": {
                      "tipo_dashboard": "instrutor",
                      "cursos": [{"codigo": "JS101", "titulo": "JavaScript B√°sico", "inscritos": 25, "taxa_conclusao": 80, "avaliacao_media": 4.5}],
                      "pendentes_correcao": 5,
                      "metricas": {"taxa_conclusao_geral": 75, "avaliacao_media_geral": 4.3, "total_alunos": 150}
                    }
                  },
                  "administrador": {
                    "summary": "Dashboard Administrador",
                    "value": {
                      "tipo_dashboard": "administrador", 
                      "metricas_gerais": {"usuarios_ativos": 500, "total_cursos": 45, "taxa_conclusao_geral": 78.5},
                      "cursos_populares": [{"codigo": "JS101", "titulo": "JavaScript", "inscricoes": 200}],
                      "alertas": [{"tipo": "Curso com baixa avalia√ß√£o", "descricao": "Curso XYZ precisa de aten√ß√£o", "prioridade": "alta"}]
                    }
                  }
                }
              }
            }
          },
          "401": {"description": "N√£o autorizado"},
          "403": {"description": "Acesso negado"}
        }
      }
    },
    "/users/v1/{id}": {
      "get": {"summary": "Obter usu√°rio por ID","tags":["users"],"security":[{"bearerAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string"}}],"responses": {"200": {"description": "OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/User"}}}},"404": {"description": "N√£o encontrado"}}},
      "patch": {"summary": "Atualiza√ß√£o composta (ADMIN ou dono)","description":"Atualiza m√∫ltiplos campos. Para promover a INSTRUTOR enviar tipo_usuario=INSTRUTOR e opcionalmente biografia e cursos_id.","tags":["users"],"security":[{"bearerAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserCompositePatch"}}}},"responses":{"200":{"description":"Usu√°rio atualizado","content":{"application/json":{"schema":{"$ref":"#/components/schemas/User"}}}},"400":{"description":"Dados inv√°lidos"},"403":{"description":"Proibido"},"404":{"description":"N√£o encontrado"}}}
    },
    "/users/v1/{id}/achievements": {
      "get": {
        "summary": "Obter conquistas do usu√°rio",
        "tags": ["achievements"],
        "security": [{"bearerAuth":[]}],
        "parameters": [{"name":"id","in":"path","required":true,"schema":{"type":"string"}}],
        "responses": {
          "200": {
            "description": "Conquistas do usu√°rio",
            "content": {
              "application/json": {
                "schema": {"$ref": "#/components/schemas/UserAchievements"}
              }
            }
          },
          "404": {"description": "Usu√°rio n√£o encontrado"}
        }
      }
    },
    "/users/v1/departments": {
      "get": {"summary":"Listar departamentos","tags":["departments"],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/Department"}}}}}}},
      "post": {"summary":"Criar departamento (ADMIN)","tags":["departments"],"security":[{"bearerAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/DepartmentCreate"}}}},"responses":{"201":{"description":"Criado","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Department"}}}},"409":{"description":"Conflito"}}}
    },
    "/users/v1/departments/{codigo}": {
      "patch": {"summary":"Atualizar departamento (ADMIN)","tags":["departments"],"security":[{"bearerAuth":[]}],"parameters":[{"name":"codigo","in":"path","required":true,"schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/DepartmentUpdate"}}}},"responses":{"200":{"description":"Atualizado","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Department"}}}},"404":{"description":"N√£o encontrado"}}}
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": {"type":"http","scheme":"bearer","bearerFormat":"JWT"}
    },
    "schemas": {
      "User": {"type":"object","properties":{"id":{"type":"string"},"nome":{"type":"string"},"email":{"type":"string"},"status":{"type":"string","enum":["ATIVO","INATIVO"]},"tipo_usuario":{"type":"string","enum":["FUNCIONARIO","INSTRUTOR","ADMIN"]},"departamento_id":{"type":"string","nullable":true},"cargo":{"type":"string","nullable":true},"xp":{"type":"integer"},"biografia":{"type":"string","nullable":true},"cursos_id":{"type":"array","items":{"type":"string"},"nullable":true},"created_at":{"type":"string","format":"date-time"},"updated_at":{"type":"string","format":"date-time"}}},
      "UserUpsert": {"type":"object","required":["nome"],"properties":{"nome":{"type":"string"},"departamento_id":{"type":"string","nullable":true},"cargo":{"type":"string","nullable":true}}},
      "UserCompositePatch": {"type":"object","properties":{"nome":{"type":"string"},"departamento_id":{"type":"string","nullable":true},"cargo":{"type":"string","nullable":true},"email":{"type":"string"},"status":{"type":"string","enum":["ATIVO","INATIVO"]},"tipo_usuario":{"type":"string","enum":["FUNCIONARIO","INSTRUTOR","ADMIN"]},"biografia":{"type":"string","nullable":true},"cursos_id":{"type":"array","items":{"type":"string"}}},"minProperties":1},
      "Instructor": {
        "type": "object",
        "properties": {
          "id": {"type": "string"},
          "nome": {"type": "string"},
          "email": {"type": "string"},
          "biografia": {"type": "string", "nullable": true},
          "curso_id": {"type": "array", "items": {"type": "string"}},
          "avaliacao_media": {"type": "number", "format": "float"},
          "departamento_id": {"type": "string", "nullable": true},
          "departamento_nome": {"type": "string", "nullable": true}
        }
      },
      "UserAchievements": {
        "type": "object",
        "properties": {
          "funcionario_id": {"type": "string"},
          "conquistas": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": {"type": "string"},
                "tipo_conquista": {"type": "string"},
                "data_conquista": {"type": "string", "format": "date-time"},
                "detalhes": {"type": "object"}
              }
            }
          },
          "total_xp": {"type": "integer"},
          "nivel_atual": {"type": "integer"}
        }
      },
      "AdminDashboard": {
        "type": "object",
        "properties": {
          "metricas_gerais": {
            "type": "object",
            "properties": {
              "usuarios_ativos": {"type": "integer"},
              "usuarios_inativos": {"type": "integer"},
              "total_funcionarios": {"type": "integer"},
              "total_instrutores": {"type": "integer"},
              "departamentos_ativos": {"type": "integer"}
            }
          },
          "engajamento_por_departamento": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "departamento": {"type": "string"},
                "usuarios_ativos": {"type": "integer"},
                "taxa_conclusao": {"type": "number", "format": "float"}
              }
            }
          },
          "cursos_populares": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "codigo": {"type": "string"},
                "titulo": {"type": "string"},
                "inscricoes": {"type": "integer"}
              }
            }
          },
          "taxa_conclusao_geral": {"type": "number", "format": "float"},
          "alertas": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "tipo": {"type": "string"},
                "mensagem": {"type": "string"},
                "prioridade": {"type": "string", "enum": ["baixa", "media", "alta"]}
              }
            }
          }
        }
      },
      "Department": {"type":"object","properties":{"codigo":{"type":"string"},"nome":{"type":"string"},"descricao":{"type":"string","nullable":true},"ativo":{"type":"boolean"}}},
      "DepartmentCreate": {"type":"object","required":["codigo","nome"],"properties":{"codigo":{"type":"string"},"nome":{"type":"string"},"descricao":{"type":"string","nullable":true}}},
      "DepartmentUpdate": {"type":"object","properties":{"nome":{"type":"string"},"descricao":{"type":"string","nullable":true},"ativo":{"type":"boolean"}},"minProperties":1}
    }
  }
}
