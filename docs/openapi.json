{
  "openapi": "3.0.3",
  "info": {
    "title": "User Service API",
    "version": "1.3.0",
    "description": "API simplificada para gestão de usuários e departamentos. Rotas legadas removidas em favor de PATCH composto."
  },
  "paths": {
  "/users/v1": {
      "get": {
        "summary": "Listar usuários (ADMIN)",
        "tags": ["users"],
    "security": [{"bearerAuth":[]}],
        "parameters": [
          {"name":"status","in":"query","schema":{"type":"string","enum":["ATIVO","INATIVO"]}},
          {"name":"departamento_id","in":"query","schema":{"type":"string"}},
          {"name":"tipo_usuario","in":"query","schema":{"type":"string","enum":["FUNCIONARIO","INSTRUTOR","ADMIN"]}},
          {"name":"search","in":"query","schema":{"type":"string"}},
          {"name":"limit","in":"query","schema":{"type":"integer","default":50,"minimum":1,"maximum":200}},
          {"name":"offset","in":"query","schema":{"type":"integer","default":0,"minimum":0}}
        ],
        "responses": {"200": {"description": "Lista de usuários","content":{"application/json":{"schema":{"type":"object","properties":{"items":{"type":"array","items":{"$ref":"#/components/schemas/User"}},"total":{"type":"integer"}}}}}}}
      },
      "post": {
        "summary": "Criar ou atualizar perfil básico do usuário autenticado",
        "tags": ["users"],
  "security": [{"bearerAuth":[]}],
        "requestBody": {"required": true, "content": {"application/json": {"schema": {"$ref": "#/components/schemas/UserUpsert"}}}},
        "responses": {"200": {"description": "Perfil atualizado","content":{"application/json":{"schema":{"$ref":"#/components/schemas/User"}}}}, "400": {"description": "Dados inválidos"}}
      }
    },
    "/users/v1/me": {
      "get": {"summary": "Obter meu perfil","tags":["users"],"security":[{"bearerAuth":[]}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/User"}}}},"404":{"description":"Não encontrado"}}}
    },
    "/users/v1/{id}": {
      "get": {"summary": "Obter usuário por ID","tags":["users"],"security":[{"bearerAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string"}}],"responses": {"200": {"description": "OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/User"}}}},"404": {"description": "Não encontrado"}}},
      "patch": {"summary": "Atualização composta (ADMIN ou dono)","description":"Atualiza múltiplos campos. Para promover a INSTRUTOR enviar tipo_usuario=INSTRUTOR e opcionalmente biografia e cursos_id.","tags":["users"],"security":[{"bearerAuth":[]}],"parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserCompositePatch"}}}},"responses":{"200":{"description":"Usuário atualizado","content":{"application/json":{"schema":{"$ref":"#/components/schemas/User"}}}},"400":{"description":"Dados inválidos"},"403":{"description":"Proibido"},"404":{"description":"Não encontrado"}}}
    },
      "/users/v1/departments": {
        "get": {"summary":"Listar departamentos","tags":["departments"],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/Department"}}}}}}},
        "post": {"summary":"Criar departamento (ADMIN)","tags":["departments"],"security":[{"bearerAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/DepartmentCreate"}}}},"responses":{"201":{"description":"Criado","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Department"}}}},"409":{"description":"Conflito"}}}
      },
      "/users/v1/departments/{codigo}": {
        "patch": {"summary":"Atualizar departamento (ADMIN)","tags":["departments"],"security":[{"bearerAuth":[]}],"parameters":[{"name":"codigo","in":"path","required":true,"schema":{"type":"string"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/DepartmentUpdate"}}}},"responses":{"200":{"description":"Atualizado","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Department"}}}},"404":{"description":"Não encontrado"}}}
      }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": {"type":"http","scheme":"bearer","bearerFormat":"JWT"}
    },
    "schemas": {
      "User": {"type":"object","properties":{"id":{"type":"string"},"nome":{"type":"string"},"email":{"type":"string"},"status":{"type":"string","enum":["ATIVO","INATIVO"]},"tipo_usuario":{"type":"string","enum":["FUNCIONARIO","INSTRUTOR","ADMIN"]},"departamento_id":{"type":"string","nullable":true},"cargo":{"type":"string","nullable":true},"xp":{"type":"integer"},"biografia":{"type":"string","nullable":true},"cursos_id":{"type":"array","items":{"type":"string"},"nullable":true},"created_at":{"type":"string","format":"date-time"},"updated_at":{"type":"string","format":"date-time"}}},
      "UserUpsert": {"type":"object","required":["nome"],"properties":{"nome":{"type":"string"},"departamento_id":{"type":"string","nullable":true},"cargo":{"type":"string","nullable":true}}},
      "UserCompositePatch": {"type":"object","properties":{"nome":{"type":"string"},"departamento_id":{"type":"string","nullable":true},"cargo":{"type":"string","nullable":true},"email":{"type":"string"},"status":{"type":"string","enum":["ATIVO","INATIVO"]},"tipo_usuario":{"type":"string","enum":["FUNCIONARIO","INSTRUTOR","ADMIN"]},"biografia":{"type":"string","nullable":true},"cursos_id":{"type":"array","items":{"type":"string"}}},"minProperties":1},
      "Department": {"type":"object","properties":{"codigo":{"type":"string"},"nome":{"type":"string"},"descricao":{"type":"string","nullable":true},"ativo":{"type":"boolean"}}},
      "DepartmentCreate": {"type":"object","required":["codigo","nome"],"properties":{"codigo":{"type":"string"},"nome":{"type":"string"},"descricao":{"type":"string","nullable":true}}},
      "DepartmentUpdate": {"type":"object","properties":{"nome":{"type":"string"},"descricao":{"type":"string","nullable":true},"ativo":{"type":"boolean"}},"minProperties":1}
    }
  }
}
